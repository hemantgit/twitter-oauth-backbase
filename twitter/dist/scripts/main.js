/* hsbc-widget-account-share@v0.1.0-alpha.0 build with â™¥ by bb-lp-cli@v1.9.14 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui")):"function"==typeof define&&define.amd?define(["base","core","ui"],t):"object"==typeof exports?exports["hsbc-widget-account-share"]=t(require("base"),require("core"),require("ui")):e["hsbc-widget-account-share"]=t(e.base,e.core,e.ui)}(this,function(e,t,n){return function(e){function t(c){if(n[c])return n[c].exports;var o=n[c]={exports:{},id:c,loaded:!1};return e[c].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,exports,t){e.exports=t(1)},function(e,exports,t){var n;(function(e){"use strict";n=function(require,exports,e){function n(){}e.name="hsbc-widget-account-share";var c=t(3),o=t(4),r=t(5),i=[o.name,r.name];e.exports=c.createModule(e.name,i).constant("WIDGET_NAME",e.name).controller(t(6)).directive(t(7)).service(t(8)).filter(t(9)).run(n)}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}).call(exports,t(2)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,exports){t.exports=e},function(e,exports){e.exports=t},function(e,exports){e.exports=n},function(e,exports,t){var n;n=function(require,exports){"use strict";function e(e,t,n,c,o,r,i){var u=this;u.model=e,u.b2gLocale=this.localeFormat(localStorage.getItem("currentLocale")),u.myCountry=u.model.PROPERTIES.IS_ENABLED_FOR_HK?"HK":"UK"}e.$inject=["WidgetModel","lpWidget","lpCoreUtils","lpCoreError","$scope","$q","$http"],e.prototype.$onInit=function(){this.listOfSoftwares=[],this.isPrimaryUser=!0,this.selectedSoftware="",this.selectedProviderName="",this.ifUniqueRefRequired=!1,this.isDataLoaded=!1,this.accountDetailsExistingFeed=[],this.accountDetailsNewFeed=[],this.userSelectedAccountsArr=[],this.companyDetails=[],this.isBtnDisabled=!0,this.uniqueRef="",this.limit=5,this.isExistingUser="",this.checkUserType(),this.loadChooseProviderData(),this.loadBankFeedData(),this.checkTermsCondition(),this.date=this.getCurrentDate()},e.prototype.localeFormat=function(e){var t="en_US";return e&&(t=e.split("-")[0]+"_"+e.split("-")[1].toUpperCase()),t},e.prototype.checkUserType=function(){var e=this;this.model.getUserType().then(function(t){"Y"!=t.data.primaryUser&&"y"!=t.data.primaryUser&&(e.isPrimaryUser=!1)})},e.prototype.loadChooseProviderData=function(){var e=this;e.model.getListOfProvider().then(function(t){404===t?e.isDataLoaded=!1:(e.isDataLoaded=!0,t.forEach(function(t){t.countries.indexOf(e.myCountry)!==-1&&e.listOfSoftwares.push({id:t.id,name:t.name,UniqueRefFormat:null!=t.rule?t.rule:"",realtime:t.realtime})}))})},e.prototype.loadBankFeedData=function(){var e=this;e.model.getListOfAccounts().then(function(t){if(404===t)e.isDataLoaded=!1;else{e.isDataLoaded!==!1,e.isExistingUser=!1;var n=!1;t.forEach(function(t){var c=[],o=[];""!=t.accountListConnected&&(e.isExistingUser=!0),t.accountListConnected.forEach(function(e){if(""!=e.subAccounts&&null!=e.subAccounts){var t=[];e.subAccounts.forEach(function(e){if(""!=e.subAccounts){var c=[];e.subAccounts.forEach(function(e){var t=null==e.balance?"":e.balance.currency,o=[];null!=e.providers&&e.providers.forEach(function(e){o.push(e.providerID)}),c.push({accountType:e.accountInfo.type,accountName:e.accountInfo.nickname,accountNumber:e.accountInfo.number,currency:t,tier:"teir3",subAccounts:"",provider:o,isSelected:n})})}var o=null==e.balance?"":e.balance.currency,r=[];null!=e.providers&&e.providers.forEach(function(e){r.push(e.providerID)}),t.push({accountType:e.accountInfo.type,accountName:e.accountInfo.nickname,accountNumber:e.accountInfo.number,currency:o,tier:"teir2",subAccounts:c,provider:r,isSelected:n})})}var o=[];null!=e.providers&&e.providers.forEach(function(e){o.push(e.providerID)}),c.push({accountType:e.accountInfo.type,accountName:e.accountInfo.nickname,accountNumber:e.accountInfo.number,currency:e.balance.currency,tier:"teir1",subAccounts:t,provider:o,isSelected:n})}),t.accountListPending.forEach(function(e){if(""!=e.subAccounts&&null!=e.subAccounts){var t=[];e.subAccounts.forEach(function(e){if(""!=e.subAccounts){var c=[];e.subAccounts.forEach(function(e){var t=null==e.balance?"":e.balance.currency;c.push({accountType:e.accountInfo.type,accountName:e.accountInfo.nickname,accountNumber:e.accountInfo.number,currency:t,tier:"teir3",subAccounts:"",isSelected:n})})}var o=null==e.balance?"":e.balance.currency;t.push({accountType:e.accountInfo.type,accountName:e.accountInfo.nickname,accountNumber:e.accountInfo.number,currency:o,tier:"teir2",subAccounts:c,isSelected:n})})}o.push({accountType:e.accountInfo.type,accountName:e.accountInfo.nickname,accountNumber:e.accountInfo.number,currency:e.balance.currency,tier:"teir1",subAccounts:t,isSelected:n})}),e.companyDetails.push({companyName:t.company.name,accountListConnected:c,accountListPending:o,isSelected:n})}),e.associatedProviders()}})},e.prototype.checkTermsCondition=function(){var e=this;e.model.getTermsConditions().then(function(t){e.condition="1"==t.data[0].ACCEPTED})},e.prototype.associatedProviders=function(){var e=this,t=[];e.existingProviderList=[],e.companyDetails.forEach(function(e){e.accountListConnected.forEach(function(e){console.log("listT1"+e),t=t.concat(e.provider),""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){t=t.concat(e.provider),""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){t=t.concat(e.provider)})})})}),t.forEach(function(t){e.listOfSoftwares.forEach(function(n){t==n.id&&e.existingProviderList.push({id:n.id,name:n.name})})}),e.existingProviderList=e.model.removeDuplicates(e.existingProviderList,"id")},e.prototype.updateUniqueRef=function(e){var t=this;""!=e?(t.uniqueRefPlaceHolder=e,t.ifUniqueRefRequired=!0):t.ifUniqueRefRequired=!1},e.prototype.chooseProviderContinue=function(){var e=this;e.listOfSoftwares.forEach(function(t){t.id==e.selectedSoftware&&(e.ifoAuthRequired=1==t.realtime)}),e.ifoAuthRequired||(e.newBankFeedFlow="selectAccounts"),e.providerName()},e.prototype.providerName=function(){var e=this;e.listOfSoftwares.forEach(function(t){t.id==e.selectedSoftware&&(e.selectedProviderName=t.name)})},e.prototype.saveSelectedAccounts=function(e){var t,n=this;n.companyDetails.forEach(function(c){t="existing"==e?c.accountListConnected:c.accountListPending,t.forEach(function(e){e.isSelected&&n.userSelectedAccountsArr.push({accountNumber:e.accountNumber,accountType:e.accountType,accountName:e.accountName,accountCurrency:e.currency,ui:"ui-tier1"}),""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){e.isSelected&&(n.userSelectedAccountsArr.push({accountNumber:e.accountNumber,accountType:e.accountType,accountName:e.accountName,accountCurrency:e.currency,ui:"ui-tier2"}),""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){n.userSelectedAccountsArr.push({accountNumber:e.accountNumber,accountType:e.accountType,accountName:e.accountName,accountCurrency:e.currency,ui:"ui-tier3"})}))})})})},e.prototype.storeData=function(e){var t=this,n={description:"",data:[]};t.userSelectedAccountsArr.forEach(function(e){var c={};c.uniqueRef=t.uniqueRef,c.accountNumber=e.accountNumber,c.accountType=e.accountType,c.accountName=e.accountName,c.accountCurrency=e.accountCurrency,c.providers=[{providerID:t.selectedSoftware}],n.data.push(c)}),t.model.sendingCustomerDetails(n,e).success(function(n,c){console.log("success"+n),t.bankFeedState=e+"-success"}).error(function(n){console.log("Error"+n),t.bankFeedState=e+"-error"}),t.model.saveTnC().success(function(e,t){}).error(function(e){})},e.prototype.selectThisAccount=function(e){var t,n,c=this;c.companyDetails.forEach(function(c){t="existing"==e?c.accountListConnected:c.accountListPending,t.forEach(function(e){e.isSelected&&(n=!0)})}),n?c.isBtnDisabled=!1:c.isBtnDisabled=!0},e.prototype.checkAll=function(e,t){var n,c=this;n="existing"==t?c.accountDetailsExistingFeed:c.accountDetailsNewFeed,c.companyDetails.forEach(function(o){n="existing"==t?o.accountListConnected:o.accountListPending,e.target.checked?c.companyDetails.forEach(function(e){n.forEach(function(e){e.isSelected=!0,""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){e.isSelected=!0,""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){e.isSelected=!0})}),c.isBtnDisabled=!1})}):n.forEach(function(e){e.isSelected=!1,""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){e.isSelected=!1,""!=e.subAccounts&&null!=e.subAccounts&&e.subAccounts.forEach(function(e){e.isSelected=!1})}),c.isBtnDisabled=!0})})},e.prototype.loadMore=function(){var e=this;e.limit+=5},e.prototype.getCurrentDate=function(){var e=new Date;return e},e.prototype.printThis=function(e){var t=window.open("","PRINT","height=900,width=900");t.document.write(document.getElementById(e).innerHTML),t.document.write("</body></html>"),t.document.print(),t.close()},e.prototype.resetAll=function(e){var t=this;t.userSelectedAccountsArr=[],t.isBtnDisabled=!0,t.uniqueRef="",t.ifUniqueRefRequired=!1,t.accountDetailsNewFeed.forEach(function(e){e.isSelected=!1}),t.accountDetailsExistingFeed.forEach(function(e){e.isSelected=!1}),t.selectedSoftware="",t.view="landingPage"},exports.MainCtrl=e}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports){"use strict";exports.termsCondition=function(){return{restrict:"AE",link:function(e,t,n){t.on("click",".tnc",function(){window.open("/portalserver/static/widgets/[BBHOST]/hsbc-widget-account-share/dist/media/business_banking_tandcs.pdf","mywin","left=30,top=30,width=900,height=600,toolbar=1,resizable=0")})}}}}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports){"use strict";function e(e,t,n,c,o){var r={IS_ENABLED_FOR_HK:n.resolvePortalPlaceholders(e.getPreference("enabledForHK")),ACCOUNTING_SOFTWARE_LIST_URL:n.resolvePortalPlaceholders(e.getPreference("getAccountingSoftwareUrl")),ACCOUNTS_LIST_URL:n.resolvePortalPlaceholders(e.getPreference("getAccountInformationUrl")),SAVE_NEW_FEED_URL:n.resolvePortalPlaceholders(e.getPreference("saveCustomerDetailsUrl")),DELETE_EXISTING_FEED_URL:n.resolvePortalPlaceholders(e.getPreference("RevokeAccessUrl")),TERMS_AND_CONDITIONS_URL:n.resolvePortalPlaceholders(e.getPreference("termsAndConditionsUrl")),SAVE_TERMS_AND_CONDITIONS_URL:n.resolvePortalPlaceholders(e.getPreference("termsAndConditionsSaveUrl")),USER_TYPE_URL:n.resolvePortalPlaceholders(e.getPreference("userIndicatorUrl"))};this.http=c,this.q=o,this.PROPERTIES=r}e.$inject=["lpWidget","lpCoreBus","lpCoreUtils","$http","$q"],e.prototype.getListOfProvider=function(){var e=this.q.defer();return this.http.get(this.PROPERTIES.ACCOUNTING_SOFTWARE_LIST_URL).then(function(t){e.resolve(t.data)},function(t){e.resolve(t.status)}),e.promise},e.prototype.getListOfAccounts=function(){var e=this.q.defer();return this.http.get(this.PROPERTIES.ACCOUNTS_LIST_URL).then(function(t){e.resolve(t.data.accountOverview)},function(t){e.resolve(t.status)}),e.promise},e.prototype.getUserType=function(){var e=this.q.defer();return this.http.get(this.PROPERTIES.USER_TYPE_URL).then(function(t){e.resolve(t)}),e.promise},e.prototype.getTermsConditions=function(){var e=this.q.defer();return this.http.get(this.PROPERTIES.TERMS_AND_CONDITIONS_URL).then(function(t){e.resolve(t)}),e.promise},e.prototype.sendingCustomerDetails=function(e,t){console.log("modal"+JSON.stringify(e));var n,c;return"revoke"===t?(console.log("revoke"),n=this.PROPERTIES.DELETE_EXISTING_FEED_URL,c="POST"):(n=this.PROPERTIES.SAVE_NEW_FEED_URL,c="put"),this.http({method:c,url:n,data:e,headers:{"Content-Type":"application/json"}})},e.prototype.saveTnC=function(e,t){return this.http({method:"put",url:this.PROPERTIES.SAVE_TERMS_AND_CONDITIONS_URL,data:"",headers:{"Content-Type":"application/json"}})},e.prototype.removeDuplicates=function(e,t){var n=[],c={};for(var o in e)c[e[o][t]]=e[o];for(o in c)n.push(c[o]);return n},exports.WidgetModel=e}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports){"use strict";exports.providerListFilter=function(){return function(e){e=e||"";var t="string"==typeof e?e:e.join(",");return t=t.replace(/ /gi,"-"),t=t.toLowerCase()}}}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}])});
//# sourceMappingURL=main.js.map